---
import { getCollection } from "astro:content";

const currentPathname = Astro.url.pathname;

// ì•Œê³ ë¦¬ì¦˜ ì½˜í…ì¸  ê°€ì ¸ì˜¤ê¸°
const algorithmPosts =
  process.env.ALGO_BUILD === "true" ? await getCollection("algorithms") : [];

// UI/UX ì½˜í…ì¸  ê°€ì ¸ì˜¤ê¸° - ìŠ¤í¬ë¦½íŠ¸ ë¶„ê¸°
const uiuxPosts =
  process.env.ALGO_BUILD === "true" ? [] : await getCollection("uiux");

function groupContentByFolder(posts) {
  if (posts.length === 0) {
    return {};
  }
  // í´ë”ë³„ ê²Œì‹œë¬¼ ê·¸ë£¹í™”
  const folderGroups = {};

  posts.forEach((post) => {
    const pathParts = post.id.split("/");
    if (pathParts.length > 1) {
      const folder = pathParts[0]; // ì²« ë²ˆì§¸ ë¶€ë¶„ì€ í´ë” ì´ë¦„

      if (!folderGroups[folder]) {
        folderGroups[folder] = [];
      }

      folderGroups[folder].push({
        id: post.id,
        title: post.data.title || post.id,
        slug: post.id,
      });
    }
  });

  return folderGroups;
}

const algoFolders = groupContentByFolder(algorithmPosts);
const uiuxFolders = groupContentByFolder(uiuxPosts);
---

<aside
  class="bg-primary-bg text-primary border-border hidden max-w-64 grow border-r p-4 md:block"
>
  <nav class="flex flex-col gap-2">
    <!-- Home -->
    <a href="/" class="hover:text-secondary font-semibold">ğŸ  Home</a>

    <!-- Algorithms ì„¹ì…˜ -->
    <details class="group" open>
      <summary
        class="hover:text-secondary flex cursor-pointer items-center justify-between font-semibold"
      >
        ğŸ“‚ Algorithms
        <span class="group-open:rotate-90">â–¶</span>
      </summary>
      <div class="mt-2 ml-4 flex flex-col gap-1">
        {
          Object.entries(algoFolders).map(([folder, files]) => (
            <details class="group" open>
              <summary class="hover:text-secondary flex cursor-pointer items-center justify-between">
                ğŸ“ {folder}
                <span class="group-open:rotate-90">â–¶</span>
              </summary>
              <div class="mt-1 ml-4 flex flex-col gap-1">
                {files.map((file) => (
                  <a
                    href={`/algorithms/${file.slug}`}
                    class={`hover:text-secondary text-sm ${`/algorithms/${file.slug}` === currentPathname ? "text-theme" : ""} `}
                  >
                    ğŸ“„ {file.title}
                  </a>
                ))}
              </div>
            </details>
          ))
        }
      </div>
    </details>

    <!-- UI/UX ì„¹ì…˜ -->
    <details class="group">
      <summary
        class="hover:text-secondary flex cursor-pointer items-center justify-between font-semibold"
      >
        ğŸ¨ UI/UX
        <span class="group-open:rotate-90">â–¶</span>
      </summary>
      <div class="mt-2 ml-4 flex flex-col gap-1">
        {
          Object.entries(uiuxFolders).map(([folder, files]) => (
            <details class="group">
              <summary class="hover:text-secondary flex cursor-pointer items-center justify-between">
                ğŸ“ {folder}
                <span class="group-open:rotate-90">â–¶</span>
              </summary>
              <div class="mt-1 ml-4 flex flex-col gap-1">
                {files.map((file) => (
                  <a
                    href={`/uiux/${file.slug}`}
                    class="hover:text-secondary text-sm"
                  >
                    ğŸ“„ {file.title}
                  </a>
                ))}
              </div>
            </details>
          ))
        }
      </div>
    </details>
  </nav>
</aside>
